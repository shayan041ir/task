# مستندات کامل پروژه سیستم مدیریت کاربران

## 📋 فهرست مطالب
1. [معرفی کلی پروژه](#معرفی-کلی-پروژه)
2. [ساختار پروژه](#ساختار-پروژه)
3. [پیکربندی دیتابیس](#پیکربندی-دیتابیس)
4. [کنترلرها](#کنترلرها)
5. [مدل‌ها و سرویس‌ها](#مدل‌ها-و-سرویس‌ها)
6. [ویوها و رابط کاربری](#ویوها-و-رابط-کاربری)
7. [مسیریابی](#مسیریابی)
8. [امنیت](#امنیت)
9. [نحوه نصب و راه‌اندازی](#نحوه-نصب-و-راه‌اندازی)
10. [استفاده از سیستم](#استفاده-از-سیستم)

---

## معرفی کلی پروژه

این پروژه یک **سیستم مدیریت کاربران** است که با استفاده از فریمورک **CodeIgniter 3** و **PHP** توسعه یافته است. این سیستم امکان ثبت‌نام، ورود، مدیریت کاربران و کنترل دسترسی‌ها را فراهم می‌کند.

### ویژگی‌های اصلی:
- ✅ سیستم احراز هویت (Authentication)
- ✅ سیستم کنترل دسترسی (Authorization) 
- ✅ پنل مدیریت کاربران
- ✅ رابط کاربری فارسی و RTL
- ✅ جدول داده‌ها با قابلیت جستجو و مرتب‌سازی
- ✅ عملیات CRUD کامل برای کاربران
- ✅ امنیت رمز عبور با BCRYPT

---

## ساختار پروژه

```
task/
├── application/                 # پوشه اصلی برنامه
│   ├── config/                 # فایل‌های پیکربندی
│   │   ├── database.php        # تنظیمات دیتابیس
│   │   ├── routes.php          # مسیریابی
│   │   └── ...
│   ├── controllers/            # کنترلرها
│   │   ├── Auth.php           # کنترلر احراز هویت
│   │   └── admin/
│   │       └── Users.php      # کنترلر مدیریت کاربران
│   ├── models/                # مدل‌ها
│   │   └── User_model.php     # مدل کاربر
│   ├── libraries/             # کتابخانه‌های سفارشی
│   │   └── UserService.php    # سرویس کاربر
│   ├── views/                 # ویوها
│   │   ├── admin/             # ویوهای پنل ادمین
│   │   ├── auth/              # ویوهای احراز هویت
│   │   └── templates/         # قالب‌های مشترک
│   └── ...
├── system/                    # هسته CodeIgniter
└── index.php                  # نقطه ورود برنامه
```

---

## پیکربندی دیتابیس

### تنظیمات دیتابیس (`application/config/database.php`)

```php
$db['default'] = array(
    'dsn'      => '',
    'hostname' => 'localhost',
    'username' => 'root',
    'password' => '',
    'database' => 'task',
    'dbdriver' => 'mysqli',
    'dbprefix' => '',
    'pconnect' => FALSE,
    'db_debug' => (ENVIRONMENT !== 'production'),
    'cache_on' => FALSE,
    'cachedir' => '',
    'char_set' => 'utf8',
    'dbcollat' => 'utf8_general_ci',
    'swap_pre' => '',
    'encrypt'  => FALSE,
    'compress' => FALSE,
    'stricton' => FALSE,
    'failover' => array(),
    'save_queries' => TRUE
);
```

### ساختار جدول کاربران

بر اساس کدهای موجود، جدول `users` باید شامل ستون‌های زیر باشد:

```sql
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL UNIQUE,
  `password` varchar(255) NOT NULL,
  `role` enum('user','admin') DEFAULT 'user',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

---

## کنترلرها

### 1. کنترلر احراز هویت (`Auth.php`)

#### متدهای اصلی:

**`register()`** - ثبت‌نام کاربر جدید
- اعتبارسنجی فرم (نام، ایمیل، رمز عبور)
- بررسی یکتایی نام و ایمیل
- هش کردن رمز عبور
- ذخیره کاربر در دیتابیس

**`login()`** - ورود کاربر
- اعتبارسنجی ایمیل و رمز عبور
- بررسی صحت رمز عبور با `password_verify()`
- ایجاد session برای کاربر
- هدایت بر اساس نقش کاربر

**`logout()`** - خروج از سیستم
- پاک کردن session
- هدایت به صفحه ورود

**`profile()`** - نمایش پروفایل کاربر
- بررسی ورود کاربر
- نمایش اطلاعات پروفایل

### 2. کنترلر مدیریت کاربران (`admin/Users.php`)

#### ویژگی‌های امنیتی:
- بررسی دسترسی ادمین در constructor
- پشتیبانی از درخواست‌های AJAX
- جلوگیری از حذف خود توسط ادمین

#### متدهای اصلی:

**`index()`** - نمایش لیست کاربران
- بارگذاری ویو لیست کاربران

**`list_json()`** - API برای DataTables
- پشتیبانی از pagination، جستجو و مرتب‌سازی
- بازگشت داده‌ها به صورت JSON

**`create()`** - ایجاد کاربر جدید
- دریافت داده‌ها از POST
- هش کردن رمز عبور
- ذخیره در دیتابیس

**`edit($id)`** - ویرایش کاربر
- دریافت اطلاعات کاربر
- پشتیبانی از درخواست‌های GET و POST
- به‌روزرسانی اطلاعات

**`delete($id)`** - حذف کاربر
- بررسی عدم حذف خود
- حذف از دیتابیس

---

## مدل‌ها و سرویس‌ها

### 1. مدل کاربر (`User_model.php`)

#### متدهای اصلی:

**عملیات CRUD:**
- `insert_user($data)` - درج کاربر جدید
- `get_user($id)` - دریافت کاربر بر اساس ID
- `get_by_email($email)` - دریافت کاربر بر اساس ایمیل
- `get_by_name($name)` - دریافت کاربر بر اساس نام
- `get_all()` - دریافت تمام کاربران
- `update_user($id, $data)` - به‌روزرسانی کاربر
- `delete_user($id)` - حذف کاربر

**پشتیبانی از DataTables:**
- `count_all()` - شمارش کل رکوردها
- `count_filtered($search)` - شمارش رکوردهای فیلتر شده
- `get_for_datatables()` - دریافت داده‌ها برای DataTables
- `build_datatables_query()` - ساخت کوئری برای DataTables

### 2. سرویس کاربر (`UserService.php`)

#### متدهای اصلی:

**`createUser($data)`** - ایجاد کاربر
- هش کردن رمز عبور
- فراخوانی مدل برای درج

**`updateUser($id, $data)`** - به‌روزرسانی کاربر
- مدیریت رمز عبور (حذف اگر خالی باشد)
- هش کردن رمز عبور جدید

**`deleteUser($id)`** - حذف کاربر
- فراخوانی مدل برای حذف

**`getById($id)`** - دریافت کاربر بر اساس ID

---

## ویوها و رابط کاربری

### 1. قالب‌های مشترک

#### `templates/header.php`
- بارگذاری Bootstrap 5
- بارگذاری DataTables
- تنظیمات RTL برای فارسی
- نمایش پیام‌های flash

#### `templates/footer.php`
- بستن تگ‌های HTML

### 2. ویوهای احراز هویت

#### `auth/login.php`
- فرم ورود با فیلدهای ایمیل و رمز عبور
- نمایش پیام‌های خطا
- لینک به صفحه ثبت‌نام

#### `auth/register.php`
- فرم ثبت‌نام با فیلدهای:
  - نام (حداقل 3 کاراکتر)
  - ایمیل (یکتا)
  - رمز عبور (حداقل 6 کاراکتر)
  - تکرار رمز عبور
  - انتخاب نقش (کاربر/ادمین)

#### `auth/profile.php`
- نمایش اطلاعات پروفایل کاربر
- دکمه خروج

### 3. ویوهای پنل ادمین

#### `admin/header.php`
- نوار ناوبری ادمین
- لینک خروج
- بارگذاری کتابخانه‌های مورد نیاز

#### `admin/dashboard.php`
- صفحه اصلی پنل ادمین
- لینک به مدیریت کاربران

#### `admin/users_list.php`
- جدول DataTables برای نمایش کاربران
- دکمه افزودن کاربر
- مودال برای افزودن/ویرایش کاربر
- اسکریپت‌های JavaScript برای:
  - بارگذاری داده‌ها
  - مدیریت مودال
  - ارسال فرم‌ها
  - حذف کاربران

#### `admin/user_form.php`
- فرم جداگانه برای افزودن/ویرایش کاربر
- اعتبارسنجی سمت کلاینت

---

## مسیریابی

### تنظیمات مسیریابی (`application/config/routes.php`)

```php
// صفحه پیش‌فرض
$route['default_controller'] = 'auth/login';

// مسیرهای احراز هویت
$route['register'] = 'auth/register';
$route['login'] = 'auth/login';
$route['logout'] = 'auth/logout';
$route['profile'] = 'auth/profile';

// مسیرهای پنل ادمین
$route['admin/users'] = 'admin/users/index';
$route['admin/users/list'] = 'admin/users/list_json';
$route['admin/users/create'] = 'admin/users/create';
$route['admin/users/edit/(:num)'] = 'admin/users/edit/$1';
$route['admin/users/delete/(:num)'] = 'admin/users/delete/$1';
```

---

## امنیت

### 1. احراز هویت
- استفاده از `password_hash()` و `password_verify()`
- ذخیره اطلاعات کاربر در session
- بررسی وضعیت ورود در هر درخواست

### 2. کنترل دسترسی
- بررسی نقش ادمین برای دسترسی به پنل مدیریت
- جلوگیری از حذف خود توسط ادمین
- پشتیبانی از درخواست‌های AJAX

### 3. اعتبارسنجی
- اعتبارسنجی سمت سرور با Form Validation
- بررسی یکتایی ایمیل و نام
- اعتبارسنجی طول رمز عبور

### 4. امنیت داده‌ها
- استفاده از `html_escape()` برای جلوگیری از XSS
- استفاده از `$this->input->post(..., true)` برای XSS filtering
- استفاده از prepared statements در CodeIgniter

---

## نحوه نصب و راه‌اندازی

### 1. پیش‌نیازها
- PHP 5.6 یا بالاتر
- MySQL 5.7 یا بالاتر
- وب سرور (Apache/Nginx)
- XAMPP/WAMP (برای توسعه محلی)

### 2. مراحل نصب

#### مرحله 1: دانلود و استقرار
```bash
# کپی کردن فایل‌ها به پوشه وب سرور
cp -r task/ /path/to/webserver/
```

#### مرحله 2: تنظیم دیتابیس
```sql
-- ایجاد دیتابیس
CREATE DATABASE task CHARACTER SET utf8 COLLATE utf8_general_ci;

-- ایجاد جدول کاربران
CREATE TABLE `users` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NOT NULL,
  `email` varchar(255) NOT NULL UNIQUE,
  `password` varchar(255) NOT NULL,
  `role` enum('user','admin') DEFAULT 'user',
  `created_at` timestamp DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

#### مرحله 3: تنظیم پیکربندی
- ویرایش `application/config/database.php`
- تنظیم اطلاعات دیتابیس

#### مرحله 4: ایجاد کاربر ادمین
```sql
-- ایجاد کاربر ادمین اولیه
INSERT INTO users (name, email, password, role) 
VALUES ('مدیر سیستم', 'admin@example.com', '$2y$10$...', 'admin');
```

### 3. دسترسی به سیستم
- باز کردن مرورگر
- رفتن به آدرس: `http://localhost/task`
- ورود با اطلاعات ادمین

---

## استفاده از سیستم

### 1. ورود به سیستم
1. باز کردن صفحه ورود
2. وارد کردن ایمیل و رمز عبور
3. کلیک روی دکمه "ورود"

### 2. ثبت‌نام کاربر جدید
1. کلیک روی "ثبت نام"
2. پر کردن فرم ثبت‌نام
3. انتخاب نقش (کاربر/ادمین)
4. کلیک روی "ثبت نام"

### 3. مدیریت کاربران (ادمین)
1. ورود با حساب ادمین
2. رفتن به "مدیریت کاربران"
3. استفاده از قابلیت‌های:
   - مشاهده لیست کاربران
   - جستجو در کاربران
   - افزودن کاربر جدید
   - ویرایش اطلاعات کاربر
   - حذف کاربر

### 4. مشاهده پروفایل
1. ورود به سیستم
2. کلیک روی "پروفایل"
3. مشاهده اطلاعات شخصی

---

## نکات مهم

### 1. امنیت
- همیشه از رمزهای قوی استفاده کنید
- به‌روزرسانی منظم سیستم
- پشتیبان‌گیری منظم از دیتابیس

### 2. عملکرد
- استفاده از DataTables برای نمایش داده‌های زیاد
- بهینه‌سازی کوئری‌های دیتابیس
- استفاده از cache در صورت نیاز

### 3. توسعه
- افزودن قابلیت‌های جدید به راحتی امکان‌پذیر است
- استفاده از الگوی MVC
- جداسازی منطق کسب‌وکار در سرویس‌ها

---

## پشتیبانی و توسعه

این سیستم با استفاده از فریمورک CodeIgniter 3 توسعه یافته و قابلیت توسعه و سفارشی‌سازی دارد. برای افزودن قابلیت‌های جدید، می‌توانید:

1. کنترلرهای جدید اضافه کنید
2. مدل‌های جدید برای داده‌ها ایجاد کنید
3. ویوهای جدید برای رابط کاربری بسازید
4. سرویس‌های جدید برای منطق کسب‌وکار اضافه کنید

---

**تاریخ ایجاد:** $(date)  
**نسخه:** 1.0  
**توسعه‌دهنده:** سیستم مدیریت کاربران CodeIgniter